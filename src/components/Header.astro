---
import type { Locale } from '../i18n/locales';
import { getLocaleFromUrl, localePath, useTranslations } from '../i18n/utils';
import HeaderLink from './HeaderLink.astro';
import LanguageSelector from './LanguageSelector.astro';

const locale = (Astro.currentLocale ?? getLocaleFromUrl(Astro.url.pathname)) as Locale;
const t = useTranslations(locale);
---

<header>
	<nav>
		<a href={localePath(locale, '/')} class="site-title">{t('site.title')}</a>
		<button class="menu-toggle" aria-label="Menu" aria-expanded="false">
			<span class="hamburger"></span>
		</button>
		<div class="nav-content">
			<div class="internal-links">
				<HeaderLink href={localePath(locale, '/')}>{t('nav.home')}</HeaderLink>
				<HeaderLink href={localePath(locale, '/blog')}>{t('nav.blog')}</HeaderLink>
				<HeaderLink href={localePath(locale, '/about')}>{t('nav.about')}</HeaderLink>
			</div>
			<div class="nav-right">
				<LanguageSelector />
				<div class="social-links">
					<a href="https://discord.gg/X3zUdkVGPX" target="_blank">
						<span class="sr-only">{t('social.discord')}</span>
						<svg viewBox="0 0 16 16" aria-hidden="true" width="28" height="28"
							><path
								fill="currentColor"
								d="M13.545 2.907a13.2 13.2 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.2 12.2 0 0 0-3.658 0 8 8 0 0 0-.412-.833.05.05 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.04.04 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032q.003.022.021.037a13.3 13.3 0 0 0 3.996 2.02.05.05 0 0 0 .056-.019q.463-.63.818-1.329a.05.05 0 0 0-.01-.059.05.05 0 0 0-.018-.011 8.8 8.8 0 0 1-1.248-.595.05.05 0 0 1-.02-.066.05.05 0 0 1 .015-.019q.084-.06.168-.123a.05.05 0 0 1 .048-.006c2.619 1.196 5.454 1.196 8.041 0a.05.05 0 0 1 .05.006q.082.063.167.123a.05.05 0 0 1-.004.085 8.3 8.3 0 0 1-1.249.594.05.05 0 0 0-.03.07q.36.7.818 1.329a.05.05 0 0 0 .056.019 13.2 13.2 0 0 0 4.001-2.02.05.05 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.03.03 0 0 0-.02-.019m-8.198 7.307c-.789 0-1.438-.724-1.438-1.612s.637-1.613 1.438-1.613c.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612m5.316 0c-.788 0-1.438-.724-1.438-1.612s.637-1.613 1.438-1.613c.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612"
							></path></svg
						>
					</a>
				</div>
			</div>
		</div>
	</nav>
</header>
<style>
	header {
		position: sticky;
		top: 0;
		z-index: 1000;
		background: rgba(255, 255, 255, 0.85);
		backdrop-filter: blur(12px);
		-webkit-backdrop-filter: blur(12px);
		border-bottom: 1px solid rgba(var(--gray-light), 0.8);
	}
	nav {
		display: flex;
		align-items: center;
		justify-content: space-between;
		max-width: 1200px;
		margin: 0 auto;
		padding: 0 1.5em;
		height: var(--header-height);
	}
	.site-title {
		font-size: 1.2em;
		font-weight: 700;
		color: rgb(var(--black));
		text-decoration: none;
		white-space: nowrap;
	}
	.site-title:hover {
		color: var(--accent);
	}
	.nav-content {
		display: flex;
		align-items: center;
		gap: 1.5em;
	}
	.internal-links {
		display: flex;
		align-items: center;
		gap: 0.25em;
	}
	.nav-right {
		display: flex;
		align-items: center;
		gap: 1em;
	}
	.social-links,
	.social-links a {
		display: flex;
		align-items: center;
	}
	.social-links {
		gap: 0.5em;
	}
	.social-links a {
		color: rgb(var(--gray));
		padding: 0.25em;
		border-radius: 6px;
		transition: color 0.2s ease, background 0.2s ease;
	}
	.social-links a:hover {
		color: rgb(var(--gray-dark));
		background: rgba(var(--gray-light), 0.5);
	}

	/* Hamburger button */
	.menu-toggle {
		display: none;
		background: none;
		border: none;
		cursor: pointer;
		padding: 8px;
		z-index: 1001;
	}
	.hamburger,
	.hamburger::before,
	.hamburger::after {
		display: block;
		width: 24px;
		height: 2px;
		background: rgb(var(--gray-dark));
		border-radius: 2px;
		transition: all 0.3s ease;
	}
	.hamburger {
		position: relative;
	}
	.hamburger::before,
	.hamburger::after {
		content: '';
		position: absolute;
		left: 0;
	}
	.hamburger::before { top: -7px; }
	.hamburger::after { top: 7px; }

	/* Open state */
	.menu-toggle[aria-expanded="true"] .hamburger {
		background: transparent;
	}
	.menu-toggle[aria-expanded="true"] .hamburger::before {
		top: 0;
		transform: rotate(45deg);
	}
	.menu-toggle[aria-expanded="true"] .hamburger::after {
		top: 0;
		transform: rotate(-45deg);
	}

	@media (max-width: 768px) {
		.menu-toggle {
			display: block;
		}
		.nav-content {
			display: none;
			position: absolute;
			top: 100%;
			left: 0;
			right: 0;
			height: calc(100vh - var(--header-height));
			z-index: 999;
			background: white;
			flex-direction: column;
			align-items: stretch;
			padding: 1.5em;
			gap: 1em;
			overflow-y: auto;
		}
		.nav-content.open {
			display: flex;
		}
		.internal-links {
			flex-direction: column;
			gap: 0;
		}
		.nav-right {
			flex-direction: column;
			align-items: stretch;
			gap: 1.5em;
			padding-top: 1em;
			border-top: 1px solid rgb(var(--gray-light));
		}
		.social-links {
			justify-content: center;
			gap: 1em;
		}
	}
</style>

<script>
	document.querySelectorAll('.menu-toggle').forEach((btn) => {
		btn.addEventListener('click', () => {
			const expanded = btn.getAttribute('aria-expanded') === 'true';
			btn.setAttribute('aria-expanded', String(!expanded));
			const nav = btn.nextElementSibling;
			if (nav) nav.classList.toggle('open');
		});
	});
</script>
